(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4995],{5917:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},8198:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]])},10489:(e,t,a)=>{"use strict";a.d(t,{b:()=>i});var s=a(12115),r=a(97602),l=a(95155),n=s.forwardRef((e,t)=>(0,l.jsx)(r.sG.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var i=n},11010:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},28744:(e,t,a)=>{Promise.resolve().then(a.bind(a,93546))},35626:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},38162:(e,t,a)=>{"use strict";a.d(t,{C1:()=>w,bL:()=>N});var s=a(12115),r=a(94446),l=a(3468),n=a(92556),i=a(23558),d=a(78108),o=a(84288),c=a(76842),u=a(97602),m=a(95155),p="Checkbox",[x,h]=(0,l.A)(p),[g,f]=x(p);function j(e){let{__scopeCheckbox:t,checked:a,children:r,defaultChecked:l,disabled:n,form:d,name:o,onCheckedChange:c,required:u,value:x="on",internal_do_not_use_render:h}=e,[f,j]=(0,i.i)({prop:a,defaultProp:null!=l&&l,onChange:c,caller:p}),[v,b]=s.useState(null),[N,y]=s.useState(null),w=s.useRef(!1),k=!v||!!d||!!v.closest("form"),_={checked:f,disabled:n,setChecked:j,control:v,setControl:b,name:o,form:d,value:x,hasConsumerStoppedPropagationRef:w,required:u,defaultChecked:!C(l)&&l,isFormControl:k,bubbleInput:N,setBubbleInput:y};return(0,m.jsx)(g,{scope:t,..._,children:"function"==typeof h?h(_):r})}var v="CheckboxTrigger",b=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,onKeyDown:l,onClick:i,...d}=e,{control:o,value:c,disabled:p,checked:x,required:h,setControl:g,setChecked:j,hasConsumerStoppedPropagationRef:b,isFormControl:N,bubbleInput:y}=f(v,a),w=(0,r.s)(t,g),k=s.useRef(x);return s.useEffect(()=>{let e=null==o?void 0:o.form;if(e){let t=()=>j(k.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[o,j]),(0,m.jsx)(u.sG.button,{type:"button",role:"checkbox","aria-checked":C(x)?"mixed":x,"aria-required":h,"data-state":A(x),"data-disabled":p?"":void 0,disabled:p,value:c,...d,ref:w,onKeyDown:(0,n.mK)(l,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,n.mK)(i,e=>{j(e=>!!C(e)||!e),y&&N&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})})});b.displayName=v;var N=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,name:s,checked:r,defaultChecked:l,required:n,disabled:i,value:d,onCheckedChange:o,form:c,...u}=e;return(0,m.jsx)(j,{__scopeCheckbox:a,checked:r,defaultChecked:l,disabled:i,required:n,onCheckedChange:o,name:s,form:c,value:d,internal_do_not_use_render:e=>{let{isFormControl:s}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(b,{...u,ref:t,__scopeCheckbox:a}),s&&(0,m.jsx)(_,{__scopeCheckbox:a})]})}})});N.displayName=p;var y="CheckboxIndicator",w=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,forceMount:s,...r}=e,l=f(y,a);return(0,m.jsx)(c.C,{present:s||C(l.checked)||!0===l.checked,children:(0,m.jsx)(u.sG.span,{"data-state":A(l.checked),"data-disabled":l.disabled?"":void 0,...r,ref:t,style:{pointerEvents:"none",...e.style}})})});w.displayName=y;var k="CheckboxBubbleInput",_=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,...l}=e,{control:n,hasConsumerStoppedPropagationRef:i,checked:c,defaultChecked:p,required:x,disabled:h,name:g,value:j,form:v,bubbleInput:b,setBubbleInput:N}=f(k,a),y=(0,r.s)(t,N),w=(0,d.Z)(c),_=(0,o.X)(n);s.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!i.current;if(w!==c&&e){let a=new Event("click",{bubbles:t});b.indeterminate=C(c),e.call(b,!C(c)&&c),b.dispatchEvent(a)}},[b,w,c,i]);let A=s.useRef(!C(c)&&c);return(0,m.jsx)(u.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=p?p:A.current,required:x,disabled:h,name:g,value:j,form:v,...l,tabIndex:-1,ref:y,style:{...l.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function A(e){return C(e)?"indeterminate":e?"checked":"unchecked"}_.displayName=k},52056:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},53511:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]])},54679:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>u,L3:()=>p,c7:()=>m,lG:()=>i,rr:()=>x,zM:()=>d});var s=a(95155);a(12115);var r=a(89511),l=a(65229),n=a(25016);function i(e){let{...t}=e;return(0,s.jsx)(r.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,s.jsx)(r.l9,{"data-slot":"dialog-trigger",...t})}function o(e){let{...t}=e;return(0,s.jsx)(r.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,s.jsx)(r.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,showCloseButton:i=!0,...d}=e;return(0,s.jsxs)(o,{"data-slot":"dialog-portal",children:[(0,s.jsx)(c,{}),(0,s.jsxs)(r.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[a,i&&(0,s.jsxs)(r.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(l.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function p(e){let{className:t,...a}=e;return(0,s.jsx)(r.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...a})}function x(e){let{className:t,...a}=e;return(0,s.jsx)(r.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...a})}},61362:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},67001:(e,t,a)=>{"use strict";a.d(t,{T:()=>l});var s=a(95155);a(12115);var r=a(25016);function l(e){let{className:t,...a}=e;return(0,s.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},78108:(e,t,a)=>{"use strict";a.d(t,{Z:()=>r});var s=a(12115);function r(e){let t=s.useRef({value:e,previous:e});return s.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},83209:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>o,ZB:()=>i,Zp:()=>l,aR:()=>n});var s=a(95155);a(12115);var r=a(25016);function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}},84916:(e,t,a)=>{"use strict";a.d(t,{S:()=>i});var s=a(95155);a(12115);var r=a(38162),l=a(5917),n=a(25016);function i(e){let{className:t,...a}=e;return(0,s.jsx)(r.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,s.jsx)(l.A,{className:"size-3.5"})})})}},85921:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])},90235:(e,t,a)=>{"use strict";a.d(t,{J:()=>n});var s=a(95155);a(12115);var r=a(10489),l=a(25016);function n(e){let{className:t,...a}=e;return(0,s.jsx)(r.b,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},93546:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>G});var s=a(95155),r=a(12115),l=a(97003),n=a(83209),i=a(55850),d=a(67812),o=a(84916),c=a(30814),u=a(61362),m=a(26983),p=a(11010),x=a(35626),h=a(8198),g=a(52619),f=a.n(g),j=a(20063),v=a(18720),b=a(19885),N=a(42855),y=a(54679),w=a(67001),k=a(90235),_=a(85921),C=a(53511),A=a(52056);function S(e){let{goalId:t,goalTitle:a,isSuspended:n,onStatusChange:i}=e,[d,o]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),[m,p]=(0,r.useState)(!1),x=async()=>{p(!0);try{let{error:e}=await N.N.from("goals").update({status:n?"active":"paused",is_suspended:!n,suspension_reason:n?null:c}).eq("id",t);if(e)throw e;v.oR.success(n?"Goal resumed successfully!":"Goal suspended successfully!"),i(),o(!1),u("")}catch(e){v.oR.error(e.message||"Failed to update goal status")}finally{p(!1)}};return(0,s.jsxs)(y.lG,{open:d,onOpenChange:o,children:[(0,s.jsx)(y.zM,{asChild:!0,children:(0,s.jsx)(l.$,{variant:"outline",size:"sm",children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"}),"Resume Goal"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"Suspend Goal"]})})}),(0,s.jsxs)(y.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(y.c7,{children:(0,s.jsx)(y.L3,{className:"flex items-center gap-2",children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.A,{className:"h-5 w-5 text-green-600"}),"Resume Goal"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.A,{className:"h-5 w-5 text-yellow-600"}),"Suspend Goal"]})})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"p-3 rounded-lg bg-muted/50",children:(0,s.jsx)("p",{className:"font-medium text-sm",children:a})}),n?(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-green-50 dark:bg-green-950/20",children:[(0,s.jsx)(_.A,{className:"h-4 w-4 text-green-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-green-800 dark:text-green-200",children:"Resume this goal"}),(0,s.jsx)("p",{className:"text-green-700 dark:text-green-300",children:"Your goal will become active again and you can continue tracking progress."})]})]})}):(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-950/20",children:[(0,s.jsx)(A.A,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Suspend this goal"}),(0,s.jsx)("p",{className:"text-yellow-700 dark:text-yellow-300",children:"Your goal will be paused and won't affect your streaks or progress tracking."})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(k.J,{htmlFor:"reason",className:"text-sm font-medium",children:"Reason for suspension (optional)"}),(0,s.jsx)(w.T,{id:"reason",placeholder:"e.g., Taking a break, focusing on other priorities...",value:c,onChange:e=>u(e.target.value),rows:3})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(l.$,{variant:"outline",onClick:()=>o(!1),className:"flex-1",children:"Cancel"}),(0,s.jsx)(l.$,{onClick:x,disabled:m,className:"flex-1",variant:n?"default":"secondary",children:m?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),n?"Resuming...":"Suspending..."]}):n?"Resume Goal":"Suspend Goal"})]})]})]})]})}function R(e){let{open:t,onOpenChange:a,goalId:n,goalTitle:i,activities:m,onComplete:p}=e,[x,h]=(0,r.useState)(new Set(m.filter(e=>e.completed).map(e=>e.id))),[g,f]=(0,r.useState)(!1),j=e=>{let t=new Set(x);t.has(e)?t.delete(e):t.add(e),h(t)},b=async()=>{f(!0);try{for(let e of m.map(e=>({id:e.id,completed:x.has(e.id)}))){let{error:t}=await N.N.from("goal_activities").update({completed:e.completed}).eq("id",e.id);if(t)throw t}let e=x.size,t=m.length,s=Math.round(e/t*100),{error:r}=await N.N.from("goals").update({progress:s,status:100===s?"completed":"active",completed_at:100===s?new Date().toISOString():null}).eq("id",n);if(r)throw r;v.oR.success("Activities updated successfully!"),p(),a(!1)}catch(e){v.oR.error(e.message||"Failed to update activities")}finally{f(!1)}},w=x.size,k=m.length,_=Math.round(w/k*100);return(0,s.jsx)(y.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(y.Cf,{className:"sm:max-w-md",children:[(0,s.jsx)(y.c7,{children:(0,s.jsxs)(y.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(c.A,{className:"h-5 w-5 text-primary"}),"Confirm Activity Completion"]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-muted/50",children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:i}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsxs)(d.E,{variant:"outline",children:[w,"/",k," completed"]}),(0,s.jsxs)(d.E,{variant:100===_?"default":"secondary",children:[_,"% progress"]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Review your completed activities:"})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:m.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg border hover:bg-accent/50 cursor-pointer",onClick:()=>j(e.id),children:[(0,s.jsx)(o.S,{checked:x.has(e.id),onChange:()=>j(e.id)}),(0,s.jsx)("span",{className:"text-sm flex-1 ".concat(x.has(e.id)?"line-through text-muted-foreground":""),children:e.title})]},e.id))})]}),100===_&&(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-green-50 dark:bg-green-950/20",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-green-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-green-800 dark:text-green-200",children:"Goal Complete!"}),(0,s.jsx)("p",{className:"text-green-700 dark:text-green-300",children:"All activities are marked as completed. This goal will be marked as finished."})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,s.jsx)(l.$,{variant:"outline",onClick:()=>a(!1),className:"flex-1",children:"Cancel"}),(0,s.jsx)(l.$,{onClick:b,disabled:g,className:"flex-1",children:g?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Updating..."]}):"Confirm Changes"})]})]})]})})}function G(){var e,t;let[a,g]=(0,r.useState)(null),[y,w]=(0,r.useState)([]),[k,_]=(0,r.useState)(!0),[C,A]=(0,r.useState)(!0),[G,E]=(0,r.useState)(!1),[z,D]=(0,r.useState)(!1),M=(0,j.useRouter)(),T=(0,j.useParams)().id;(0,r.useEffect)(()=>{O()},[T]);let O=async()=>{try{if(!await N._.getCurrentUser())return void M.push("/auth/login");let{data:e,error:t}=await N.N.from("goals").select("*").eq("id",T).maybeSingle();if(t||!e){v.oR.error("Goal not found"),g(null),_(!1);return}if(e.completed_at||"completed"===e.status){g({...e,completed_at:e.completed_at||new Date().toISOString()}),A(!1),E(!1),_(!1);return}let a=new Date().toISOString().split("T")[0],s=e.start_date?e.start_date.split("T")[0]:null,r="pending"===e.status||s&&s>a,l=!1;if(r&&s){let e=new Date(s).getTime();l=Date.now()<=e-18e6}else{let t=new Date(e.created_at).getTime();l=Date.now()-t<=18e6}if(E(l),A(!0),g(e),"multi-activity"===e.goal_type){let{data:e}=await N.N.from("goal_activities").select("*").eq("goal_id",T).order("order_index");w(e||[])}else w([{id:"single",title:e.title,completed:"completed"===e.status,goal_id:T,order_index:0}]);_(!1)}catch(e){console.error("Error loading goal:",e),v.oR.error("Failed to load goal"),_(!1)}},F=async e=>{if("completed"===a.status||a.completed_at)return void v.oR.error("Goal is completed and cannot be updated");try{let t=await N._.getCurrentUser();if(!t)return;let s=y.map((t,a)=>a===e?{...t,completed:!t.completed}:t);w(s);let r=y[e];"single"!==r.id&&await N.N.from("goal_activities").update({completed:!r.completed}).eq("id",r.id);let l=s.filter(e=>e.completed).length,n=s.length>0?Math.round(l/s.length*100):0,i=100===n,{error:d}=await N.N.from("goals").update({progress:n,status:i?"completed":"active",completed_at:i?new Date().toISOString():null,updated_at:new Date().toISOString()}).eq("id",T);if(d){console.error("Error updating goal:",d),v.oR.error("Failed to update progress");return}if(await N.N.from("notifications").insert({user_id:t.id,title:s[e].completed?"Activity Completed!":"Activity Unchecked",message:s[e].completed?"You completed: ".concat(r.title||"an activity"):"You unchecked: ".concat(r.title||"an activity"),type:"activity_completed",read:!1,data:{goal_id:T,activity_id:r.id}}),i){try{await N.N.from("notifications").insert({user_id:t.id,title:"Goal Completed! \uD83C\uDF89",message:"Congratulations! You completed: ".concat(null==a?void 0:a.title),type:"goal_completed",read:!1,data:{goal_id:T}})}catch(e){console.error("Failed to create completion notification:",e)}try{let{data:e}=await N.N.from("goals").select("id",{count:"exact"}).eq("user_id",t.id).eq("status","completed");1===e&&await N.N.from("user_achievements").insert({user_id:t.id,achievement_type:"first_completion",unlocked_at:new Date().toISOString(),data:{goal_id:T}}),10===e&&await N.N.from("user_achievements").insert({user_id:t.id,achievement_type:"goal_master",unlocked_at:new Date().toISOString(),data:{completed_goals:e}})}catch(e){console.error("Failed to check completion achievements:",e)}}window.dispatchEvent(new CustomEvent("goalUpdated")),v.oR.success(i?"Goal completed! \uD83C\uDF89":"Progress updated!"),i&&setTimeout(()=>O(),500)}catch(e){console.error("Error toggling activity:",e),v.oR.error("Failed to update progress")}};if(k)return(0,s.jsx)(b.O,{children:(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)(c.A,{className:"h-12 w-12 text-primary animate-pulse"})})});if(!a)return(0,s.jsx)(b.O,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Goal not found"}),(0,s.jsx)(f(),{href:"/goals",children:(0,s.jsx)(l.$,{children:"Back to Goals"})})]})});if(a.completed_at)return(0,s.jsx)(b.O,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83C\uDF89"}),(0,s.jsx)("p",{className:"text-lg font-semibold mb-2",children:"Goal Completed!"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"This goal has been completed and can no longer be updated."}),(0,s.jsx)(f(),{href:"/goals/".concat(T),children:(0,s.jsx)(l.$,{children:"View Goal Details"})})]})});let P=y.filter(e=>e.completed).length,I=y.length,L=I>0?Math.round(P/I*100):0;return(0,s.jsxs)(b.O,{children:[!C&&"completed"===a.status&&(0,s.jsx)(n.Zp,{className:"border-green-200 bg-green-50 shadow-[0_18px_40px_rgba(15,23,42,0.12)]",children:(0,s.jsxs)(n.Wu,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("span",{className:"font-medium text-green-900",children:"Goal Completed"})]}),(0,s.jsx)("p",{className:"text-sm text-green-700",children:"This goal has been completed and can no longer be updated."})]})}),"pending"===a.status&&(0,s.jsx)(n.Zp,{className:"border-blue-200 bg-blue-50 shadow-[0_18px_40px_rgba(15,23,42,0.12)]",children:(0,s.jsxs)(n.Wu,{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(m.A,{className:"h-4 w-4 text-blue-600"}),(0,s.jsx)("span",{className:"font-medium text-blue-900",children:"Goal Pending"})]}),(0,s.jsxs)("p",{className:"text-sm text-blue-700",children:["This goal will become active on ",a.start_date?new Date(a.start_date).toLocaleDateString():"the start date",". You can still edit activities and dates."]})]})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Update Goal Progress"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"pending"===a.status?"Goal is pending - you can edit activities and dates":"Mark activities as completed to track your progress"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[G&&(0,s.jsx)(f(),{href:"/goals/".concat(T,"/edit"),children:(0,s.jsxs)(l.$,{variant:"outline",size:"sm",children:[(0,s.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Edit Goal"]})}),(0,s.jsx)(S,{goalId:T,goalTitle:a.title,isSuspended:"paused"===a.status||a.is_suspended,onStatusChange:O}),(0,s.jsxs)(l.$,{variant:"outline",onClick:()=>M.push("/goals"),children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Back to Goals"]})]})]}),(0,s.jsxs)(n.Zp,{className:"border-slate-200 bg-white shadow-[0_18px_40px_rgba(15,23,42,0.14)] dark:border-slate-800 dark:bg-slate-900",children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(c.A,{className:"h-5 w-5"}),a.title]})}),(0,s.jsxs)(n.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Progress"}),(0,s.jsxs)("span",{className:"font-medium",children:[L,"%"]})]}),(0,s.jsx)(i.k,{value:L,className:"h-2"})]}),"recurring"===a.scheduleType&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-4 w-4 text-orange-500"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Current Streak: ",a.streak||0," days"]})]})]})]}),"multi-activity"===a.goal_type&&(0,s.jsxs)(n.Zp,{className:"border-slate-200 bg-white shadow-[0_18px_40px_rgba(15,23,42,0.14)] dark:border-slate-800 dark:bg-slate-900",children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(n.ZB,{children:"Activities"}),(0,s.jsxs)(l.$,{onClick:()=>D(!0),disabled:!C||"pending"===a.status,size:"sm",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Confirm Completion"]})]})}),(0,s.jsx)(n.Wu,{className:"space-y-3",children:y.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border",children:[(0,s.jsx)(o.S,{checked:e.completed,onCheckedChange:()=>F(t),disabled:"pending"===a.status}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("span",{className:"text-sm ".concat(e.completed?"line-through text-muted-foreground":""),children:e.title||"Activity"})}),e.completed&&(0,s.jsxs)(d.E,{className:"bg-green-600",children:[(0,s.jsx)(u.A,{className:"h-3 w-3 mr-1"}),"Done"]})]},t))})]}),"single-activity"===a.goal_type&&(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{children:"Mark as Complete"})}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(l.$,{onClick:()=>D(!0),className:"w-full",variant:(null==(e=y[0])?void 0:e.completed)?"outline":"default",disabled:"pending"===a.status,children:(null==(t=y[0])?void 0:t.completed)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Completed"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Mark as Complete"]})})})]}),(0,s.jsx)(R,{open:z,onOpenChange:D,goalId:T,goalTitle:a.title,activities:y.map(e=>({id:e.id,title:e.title,completed:e.completed})),onComplete:O})]})]})}}},e=>{e.O(0,[297,5707,8760,1370,3224,6227,8720,9885,8441,1255,7358],()=>e(e.s=28744)),_N_E=e.O()}]);