(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1728],{5917:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},10489:(e,t,s)=>{"use strict";s.d(t,{b:()=>i});var a=s(12115),r=s(97602),n=s(95155),l=a.forwardRef((e,t)=>(0,n.jsx)(r.sG.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=l},16485:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},35626:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},35658:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a=s(95155),r=s(12115),n=s(97003),l=s(83209),i=s(84916),d=s(67812),c=s(55850),o=s(67001),u=s(90235),m=s(30814),x=s(35626),p=s(61362),h=s(16485);let f=(0,s(71847).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var g=s(20063),j=s(18720),v=s(19885),y=s(42855);function N(){var e;let[t,s]=(0,r.useState)(null),[N,b]=(0,r.useState)([]),[w,k]=(0,r.useState)(!1),[_,C]=(0,r.useState)(""),[R,S]=(0,r.useState)(!0),A=(0,g.useRouter)(),E=(0,g.useParams)().id;(0,r.useEffect)(()=>{let e=async()=>{try{let e=await y._.getCurrentUser();if(!e)return void A.push("/auth/login");let{data:t,error:a}=await y.N.from("goals").select("*").eq("id",E).eq("user_id",e.id).single();if(a||!t){j.oR.error("Goal not found"),A.push("/goals");return}s(t),S("completed"!==t.status);let{data:r}=await y.N.from("goal_activities").select("*").eq("goal_id",E).order("order_index");b(r||[])}catch(e){console.error("Error loading goal:",e),j.oR.error("Failed to load goal"),A.push("/goals")}};E&&e()},[E,A]);let D=async(e,t)=>{if(!R)return void j.oR.error("Goal is completed and cannot be updated");try{let{error:s}=await y.N.from("goal_activities").update({completed:t}).eq("id",e);if(s)throw s;b(s=>s.map(s=>s.id===e?{...s,completed:t}:s));let a=N.map(s=>s.id===e?{...s,completed:t}:s),r=a.filter(e=>e.completed).length,n=Math.round(r/a.length*100);await y.N.from("goals").update({progress:n}).eq("id",E),j.oR.success(t?"Activity completed!":"Activity marked as incomplete")}catch(e){j.oR.error(e.message||"Failed to update activity")}},M=async()=>{if(R){k(!0);try{let{error:e}=await y.N.from("goals").update({status:"completed",progress:100,completed_at:new Date().toISOString(),completion_note:_}).eq("id",E);if(e)throw e;await y.N.from("goal_activities").update({completed:!0}).eq("goal_id",E);try{await y.N.from("notifications").insert({user_id:t.user_id,title:"Seasonal Goal Completed! \uD83C\uDF86",message:"Congratulations! You completed your seasonal goal: ".concat(t.title),type:"seasonal_goal_completed",read:!1,data:{goal_id:E,duration_type:t.duration_type}})}catch(e){console.error("Failed to create notification:",e)}try{let{data:e}=await y.N.from("goals").select("id",{count:"exact"}).eq("user_id",t.user_id).eq("is_seasonal",!0).eq("status","completed");1===e&&await y.N.from("user_achievements").insert({user_id:t.user_id,achievement_type:"seasonal_achiever",unlocked_at:new Date().toISOString(),data:{goal_id:E,duration_type:t.duration_type}}),"annual"===t.duration_type&&e>=2&&await y.N.from("user_achievements").insert({user_id:t.user_id,achievement_type:"year_transformer",unlocked_at:new Date().toISOString(),data:{completed_annual_goals:e}})}catch(e){console.error("Failed to check completion achievements:",e)}j.oR.success("Congratulations! Goal marked as completed!"),window.dispatchEvent(new CustomEvent("goalUpdated",{detail:{goalId:E}})),A.push("/goals")}catch(e){j.oR.error(e.message||"Failed to complete goal")}finally{k(!1)}}};if(!t)return(0,a.jsx)(v.O,{children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(m.A,{className:"h-12 w-12 text-primary animate-pulse mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading goal..."})]})})});let Z=N.filter(e=>e.completed).length,G=N.length>0?Math.round(Z/N.length*100):0,B=N.length>0&&Z===N.length;return(0,a.jsx)(v.O,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Update Seasonal Goal"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Track your progress and mark milestones as complete"})]}),(0,a.jsxs)(n.$,{variant:"outline",onClick:()=>A.push("/goals"),children:[(0,a.jsx)(x.A,{className:"h-4 w-4 mr-2"}),"Back to Goals"]})]}),!R&&(0,a.jsx)(l.Zp,{className:"border-green-200 bg-green-50",children:(0,a.jsxs)(l.Wu,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{className:"font-medium text-green-900",children:"Goal Completed"})]}),(0,a.jsx)("p",{className:"text-sm text-green-700",children:"This goal has been completed and can no longer be updated."})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-5 w-5 text-primary"}),t.title]}),(0,a.jsx)(l.BT,{children:t.description})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Overall Progress"}),(0,a.jsxs)("span",{className:"font-medium",children:[G,"%"]})]}),(0,a.jsx)(c.k,{value:G,className:"h-3"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Completed Milestones"}),(0,a.jsxs)("span",{className:"font-medium",children:[Z," of ",N.length]})]})]})})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Milestones"}),(0,a.jsx)(l.BT,{children:"Check off milestones as you complete them"})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:N.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start space-x-3 p-4 rounded-lg border bg-card",children:[(0,a.jsx)(i.S,{id:"activity-".concat(e.id),checked:e.completed,onCheckedChange:t=>D(e.id,!!t),disabled:!R,className:"mt-1"}),(0,a.jsx)("div",{className:"flex-1 space-y-2",children:(0,a.jsx)(u.J,{htmlFor:"activity-".concat(e.id),className:"cursor-pointer font-medium ".concat(e.completed?"line-through text-muted-foreground":""),children:e.title})}),e.completed&&(0,a.jsx)(p.A,{className:"h-5 w-5 text-green-600 mt-1"})]},e.id))})})]}),B&&R&&(0,a.jsxs)(l.Zp,{className:"border-green-200 bg-green-50",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2 text-green-900",children:[(0,a.jsx)(p.A,{className:"h-5 w-5"}),"Ready to Complete Goal"]}),(0,a.jsx)(l.BT,{className:"text-green-700",children:"All milestones completed! Mark this goal as finished."})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"completion-note",children:"Completion Note (Optional)"}),(0,a.jsx)(o.T,{id:"completion-note",placeholder:"Add a note about your achievement, lessons learned, or next steps...",value:_,onChange:e=>C(e.target.value),rows:3})]}),(0,a.jsx)(n.$,{onClick:M,disabled:w,className:"w-full bg-green-600 hover:bg-green-700",children:w?"Completing...":"Mark Goal as Complete"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Goal Details"})}),(0,a.jsxs)(l.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Type:"}),(0,a.jsx)(d.E,{variant:"outline",children:"Seasonal"})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Duration:"}),(0,a.jsx)("span",{className:"capitalize",children:t.duration_type})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Status:"}),(0,a.jsx)(d.E,{variant:"completed"===t.status?"default":"secondary",children:t.status})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Category:"}),(0,a.jsx)("span",{className:"capitalize",children:null==(e=t.category)?void 0:e.replace("_"," ")})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,a.jsx)("span",{children:new Date(t.created_at).toLocaleDateString()})]}),t.target_date&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Target Date:"}),(0,a.jsx)("span",{children:new Date(t.target_date).toLocaleDateString()})]}),t.completed_at&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Completed:"}),(0,a.jsx)("span",{children:new Date(t.completed_at).toLocaleDateString()})]})]})]}),t.completion_note&&(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(f,{className:"h-4 w-4"}),"Completion Note"]})}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:t.completion_note})})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{children:"Progress Stats"})}),(0,a.jsxs)(l.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Progress:"}),(0,a.jsxs)("span",{className:"font-medium",children:[G,"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Completed:"}),(0,a.jsx)("span",{className:"font-medium",children:Z})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Remaining:"}),(0,a.jsx)("span",{className:"font-medium",children:N.length-Z})]}),(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total:"}),(0,a.jsx)("span",{className:"font-medium",children:N.length})]})]})]})]})]})]})})}},38162:(e,t,s)=>{"use strict";s.d(t,{C1:()=>w,bL:()=>N});var a=s(12115),r=s(94446),n=s(3468),l=s(92556),i=s(23558),d=s(78108),c=s(84288),o=s(76842),u=s(97602),m=s(95155),x="Checkbox",[p,h]=(0,n.A)(x),[f,g]=p(x);function j(e){let{__scopeCheckbox:t,checked:s,children:r,defaultChecked:n,disabled:l,form:d,name:c,onCheckedChange:o,required:u,value:p="on",internal_do_not_use_render:h}=e,[g,j]=(0,i.i)({prop:s,defaultProp:null!=n&&n,onChange:o,caller:x}),[v,y]=a.useState(null),[N,b]=a.useState(null),w=a.useRef(!1),k=!v||!!d||!!v.closest("form"),_={checked:g,disabled:l,setChecked:j,control:v,setControl:y,name:c,form:d,value:p,hasConsumerStoppedPropagationRef:w,required:u,defaultChecked:!C(n)&&n,isFormControl:k,bubbleInput:N,setBubbleInput:b};return(0,m.jsx)(f,{scope:t,..._,children:"function"==typeof h?h(_):r})}var v="CheckboxTrigger",y=a.forwardRef((e,t)=>{let{__scopeCheckbox:s,onKeyDown:n,onClick:i,...d}=e,{control:c,value:o,disabled:x,checked:p,required:h,setControl:f,setChecked:j,hasConsumerStoppedPropagationRef:y,isFormControl:N,bubbleInput:b}=g(v,s),w=(0,r.s)(t,f),k=a.useRef(p);return a.useEffect(()=>{let e=null==c?void 0:c.form;if(e){let t=()=>j(k.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,j]),(0,m.jsx)(u.sG.button,{type:"button",role:"checkbox","aria-checked":C(p)?"mixed":p,"aria-required":h,"data-state":R(p),"data-disabled":x?"":void 0,disabled:x,value:o,...d,ref:w,onKeyDown:(0,l.mK)(n,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,l.mK)(i,e=>{j(e=>!!C(e)||!e),b&&N&&(y.current=e.isPropagationStopped(),y.current||e.stopPropagation())})})});y.displayName=v;var N=a.forwardRef((e,t)=>{let{__scopeCheckbox:s,name:a,checked:r,defaultChecked:n,required:l,disabled:i,value:d,onCheckedChange:c,form:o,...u}=e;return(0,m.jsx)(j,{__scopeCheckbox:s,checked:r,defaultChecked:n,disabled:i,required:l,onCheckedChange:c,name:a,form:o,value:d,internal_do_not_use_render:e=>{let{isFormControl:a}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(y,{...u,ref:t,__scopeCheckbox:s}),a&&(0,m.jsx)(_,{__scopeCheckbox:s})]})}})});N.displayName=x;var b="CheckboxIndicator",w=a.forwardRef((e,t)=>{let{__scopeCheckbox:s,forceMount:a,...r}=e,n=g(b,s);return(0,m.jsx)(o.C,{present:a||C(n.checked)||!0===n.checked,children:(0,m.jsx)(u.sG.span,{"data-state":R(n.checked),"data-disabled":n.disabled?"":void 0,...r,ref:t,style:{pointerEvents:"none",...e.style}})})});w.displayName=b;var k="CheckboxBubbleInput",_=a.forwardRef((e,t)=>{let{__scopeCheckbox:s,...n}=e,{control:l,hasConsumerStoppedPropagationRef:i,checked:o,defaultChecked:x,required:p,disabled:h,name:f,value:j,form:v,bubbleInput:y,setBubbleInput:N}=g(k,s),b=(0,r.s)(t,N),w=(0,d.Z)(o),_=(0,c.X)(l);a.useEffect(()=>{if(!y)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!i.current;if(w!==o&&e){let s=new Event("click",{bubbles:t});y.indeterminate=C(o),e.call(y,!C(o)&&o),y.dispatchEvent(s)}},[y,w,o,i]);let R=a.useRef(!C(o)&&o);return(0,m.jsx)(u.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=x?x:R.current,required:p,disabled:h,name:f,value:j,form:v,...n,tabIndex:-1,ref:b,style:{...n.style,..._,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function R(e){return C(e)?"indeterminate":e?"checked":"unchecked"}_.displayName=k},41954:(e,t,s)=>{Promise.resolve().then(s.bind(s,35658))},61362:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},67001:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var a=s(95155);s(12115);var r=s(25016);function n(e){let{className:t,...s}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}},78108:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});var a=s(12115);function r(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},83209:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>l});var a=s(95155);s(12115);var r=s(25016);function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...s})}},84916:(e,t,s)=>{"use strict";s.d(t,{S:()=>i});var a=s(95155);s(12115);var r=s(38162),n=s(5917),l=s(25016);function i(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"checkbox",className:(0,l.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(n.A,{className:"size-3.5"})})})}},90235:(e,t,s)=>{"use strict";s.d(t,{J:()=>l});var a=s(95155);s(12115);var r=s(10489),n=s(25016);function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}}},e=>{e.O(0,[297,5707,8760,1370,3224,6227,8720,9885,8441,1255,7358],()=>e(e.s=41954)),_N_E=e.O()}]);