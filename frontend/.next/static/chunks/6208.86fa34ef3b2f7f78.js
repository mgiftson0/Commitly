"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6208],{46208:(e,t,r)=>{r.r(t),r.d(t,{checkAndUnlockAchievements:()=>a,getAchievementProgress:()=>o,getUserAchievements:()=>c,triggerAchievementCheck:()=>n});var i=r(42855);async function a(){try{let e=await i._.getCurrentUser();if(!e)return[];let{data:t,error:r}=await i.N.from("goals").select("*").eq("user_id",e.id);if(r)throw r;let{data:a,error:n}=await i.N.from("user_achievements").select("achievement_id").eq("user_id",e.id);if(n)throw n;let c=new Set((a||[]).map(e=>e.achievement_id)),{data:o,error:l}=await i.N.from("achievements").select("*");if(l)throw l;let s=[];for(let r of o||[]){if(c.has(r.id))continue;let a=!1;switch(r.name){case"First Goal":a=((null==t?void 0:t.length)||0)>=1;break;case"Goal Achiever":a=((null==t?void 0:t.filter(e=>"completed"===e.status).length)||0)>=1;break;case"Goal Master":a=((null==t?void 0:t.filter(e=>"completed"===e.status).length)||0)>=10;break;default:a=!1}if(a){let{error:t}=await i.N.from("user_achievements").insert({user_id:e.id,achievement_id:r.id,unlocked_at:new Date().toISOString()});t||(await i.N.from("notifications").insert({user_id:e.id,title:"Achievement Unlocked!",message:"You've unlocked \"".concat(r.title,'" - ').concat(r.description),type:"achievement_unlocked",read:!1,data:{achievement_id:r.id,rarity:r.rarity}}),s.push(r),window.dispatchEvent(new CustomEvent("achievementUnlocked",{detail:r})))}}return s}catch(e){return console.error("Error checking achievements:",e),[]}}function n(){clearTimeout(window.achievementCheckTimeout),window.achievementCheckTimeout=setTimeout(()=>{a()},1e3)}async function c(){try{let e=await i._.getCurrentUser();if(!e)return[];let{data:t,error:r}=await i.N.from("user_achievements").select("*").eq("user_id",e.id).order("unlocked_at",{ascending:!1});if(r)throw r;return t||[]}catch(e){return console.error("Error getting user achievements:",e),[]}}async function o(e){try{let t=await i._.getCurrentUser();if(!t)return null;let{data:r,error:a}=await i.N.from("achievements").select("*").eq("id",e).single();if(a||!r)return null;let{data:n,error:c}=await i.N.from("goals").select("*").eq("user_id",t.id);if(c)throw c;let o=0,l=1;switch(r.name){case"First Goal":o=Math.min((null==n?void 0:n.length)||0,1),l=1;break;case"Goal Achiever":o=Math.min((null==n?void 0:n.filter(e=>"completed"===e.status).length)||0,1),l=1;break;case"Goal Master":o=Math.min((null==n?void 0:n.filter(e=>"completed"===e.status).length)||0,10),l=10}return{achievement:r,progress:o,total:l,unlocked:o>=l,percentage:Math.round(o/l*100)}}catch(e){return console.error("Error getting achievement progress:",e),null}}}}]);